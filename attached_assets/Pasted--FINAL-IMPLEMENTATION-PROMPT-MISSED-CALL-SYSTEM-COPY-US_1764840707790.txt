‚úÖ FINAL IMPLEMENTATION PROMPT ‚Äî MISSED CALL SYSTEM (COPY & USE AS-IS)

"Implement a complete WhatsApp-style missed call tracking system for my chat application using the following exact logic and specifications."

1. GENERAL BEHAVIOR

When User A calls User B:

‚úî Case 1 ‚Äî B is offline

Call is not received.

Store the event as a missed call for B.

When B comes online, show notification badges on:

Specific chat with A

Call icon (voice or video)

Global ‚ÄúMissed Calls‚Äù history page

‚úî Case 2 ‚Äî B is online but does not answer

After timeout (e.g., 20 seconds), mark as missed.

Same storing logic as above.

‚úî Case 3 ‚Äî B opens the chat

Reset missed call count ONLY for that specific caller.

Do not delete call history.

2. DATABASE STRUCTURE

Create a table/collection:

missed_calls
Field	Type	Description
id	PK	unique identifier
caller_id	FK	user who made the call
receiver_id	FK	user who missed the call
call_type	ENUM("voice","video")	type of call
timestamp	datetime	when the call happened
is_seen	boolean	whether receiver opened chat and the count is cleared
3. WHEN CALL IS INITIATED
On user A calling B:
if B is offline:
    create missed_call record (caller=A, receiver=B)
    increment "missed_call_count[B][A]" by 1
    emit socket event to B: "missed_call_update"
else:
    initiate normal ringing logic

4. WHEN CALL TIMES OUT (NOT PICKED)
After 20‚Äì30 seconds:
if call not answered:
    create missed_call record
    increase missed count for B
    send socket event to B if online

5. WHEN RECEIVER COMES ONLINE
On B reconnect socket:
fetch all missed_call where receiver=B and is_seen=false
group by caller_id + call_type
for each caller: 
    send UI badge count to B (e.g., 2 missed video calls)
also send total missed_calls count to show on header/global call history

6. UI BADGE LOGIC (PER-USER CHAT VIEW)

Inside A‚ÜîB chat page:

Display:

If B missed 2 video calls from A ‚Üí show ‚Äú2‚Äù badge on video icon

If B missed 1 voice call from A ‚Üí show ‚Äú1‚Äù on voice icon

Separate counts:

missed_voice_calls[A][B]  
missed_video_calls[A][B]


Badge resets when B opens chat:

set is_seen=true where receiver=B AND caller=A
reset badge count for that caller+type

7. GLOBAL MISSED CALL HISTORY PAGE

Implement a new page:

Missed Call History Screen

Shows ALL missed calls for the logged-in user.

Format:

[User Profile Pic]  
User Name  
Missed Video Call ‚Äì 2:15 PM  
Missed Voice Call ‚Äì Yesterday  
...


Should include:

Username of caller

Call type (voice / video)

Timestamp

Status (missed / seen)

Sort by timestamp DESC.

Example:

A ‚Üí B : Missed Video Call @ 3:00 PM  
C ‚Üí B : Missed Voice Call @ 1:30 PM  
A ‚Üí B : Missed Voice Call @ Yesterday  

8. SOCKET EVENTS REQUIRED
a) call_initiated

Sent when A calls B.

b) call_missed

Sent to B when call fails or B is offline.

c) missed_call_update

Sent to B on:

reconnect

new missed call

unread missed_call_count update

Payload example:

{
  total_missed: 4,
  per_user: {
     "A": { voice: 1, video: 2 },
     "C": { voice: 1, video: 0 }
  }
}

d) reset_missed_calls

Sent when B opens a chat with A to reset count.

9. FRONTEND BADGE BEHAVIOR

Inside chat list:

User A ‚Üí missed: 3  
User C ‚Üí missed: 1  


Inside header (global count):

üîî Missed Calls: 4


Inside chat with A:

Video call icon shows "2"
Voice call icon shows "1"

10. CLEARING MISSED CALL COUNTS

When receiver B opens A‚Äôs chat:

mark all missed_calls where receiver=B AND caller=A as is_seen=true
reset badge only for A
update total missed global count
emit reset event to UI


When user opens ‚ÄúMissed Call History‚Äù page:

Do NOT delete records

Only show list

Optionally mark all as seen after user scrolls through the page

11. OPTIONAL (HIGHLY RECOMMENDED)
‚úî Store full call logs, not just missed calls

This enables:

Complete call history

Outgoing/incoming/missed labels

Filtering by video/voice

UI like WhatsApp call logs

Table structure:

call_logs: id, caller_id, receiver_id, type, status, duration, timestamp
