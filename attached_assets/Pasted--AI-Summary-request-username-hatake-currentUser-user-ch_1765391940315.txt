üìù AI Summary request: {
  username: 'hatake',
  currentUser: 'user',
  chatRoomId: 'hatake_user',
  includeAll: false
}
üìù Last summary time: null
üìù Found messages in chatroom: 21
üìù Messages to summarize (received by user): 8
Chat decryption error: Error: Decryption failed
    at decryptWithChatKey (/home/runner/workspace/server/lib/chatCrypto.js:65:13)
    at decryptMessageWithChatKeys (/home/runner/workspace/server/lib/chatCrypto.js:129:27)
    at file:///home/runner/workspace/server/routes/chatSummary.js:153:29
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Failed to decrypt message for summary: Decryption failed
Chat decryption error: Error: Decryption failed
    at decryptWithChatKey (/home/runner/workspace/server/lib/chatCrypto.js:65:13)
    at decryptMessageWithChatKeys (/home/runner/workspace/server/lib/chatCrypto.js:129:27)
    at file:///home/runner/workspace/server/routes/chatSummary.js:153:29
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Failed to decrypt message for summary: Decryption failed
Chat decryption error: Error: Decryption failed
    at decryptWithChatKey (/home/runner/workspace/server/lib/chatCrypto.js:65:13)
    at decryptMessageWithChatKeys (/home/runner/workspace/server/lib/chatCrypto.js:129:27)
    at file:///home/runner/workspace/server/routes/chatSummary.js:153:29
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Failed to decrypt message for summary: Decryption failed
Chat decryption error: Error: Decryption failed
    at decryptWithChatKey (/home/runner/workspace/server/lib/chatCrypto.js:65:13)
    at decryptMessageWithChatKeys (/home/runner/workspace/server/lib/chatCrypto.js:129:27)
    at file:///home/runner/workspace/server/routes/chatSummary.js:153:29
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Failed to decrypt message for summary: Decryption failed
Chat decryption error: Error: Decryption failed
    at decryptWithChatKey (/home/runner/workspace/server/lib/chatCrypto.js:65:13)
    at decryptMessageWithChatKeys (/home/runner/workspace/server/lib/chatCrypto.js:129:27)
    at file:///home/runner/workspace/server/routes/chatSummary.js:153:29
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Failed to decrypt message for summary: Decryption failed
Chat decryption error: Error: Decryption failed
    at decryptWithChatKey (/home/runner/workspace/server/lib/chatCrypto.js:65:13)
    at decryptMessageWithChatKeys (/home/runner/workspace/server/lib/chatCrypto.js:129:27)
    at file:///home/runner/workspace/server/routes/chatSummary.js:153:29
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Failed to decrypt message for summary: Decryption failed
Chat decryption error: Error: Decryption failed
    at decryptWithChatKey (/home/runner/workspace/server/lib/chatCrypto.js:65:13)
    at decryptMessageWithChatKeys (/home/runner/workspace/server/lib/chatCrypto.js:129:27)
    at file:///home/runner/workspace/server/routes/chatSummary.js:153:29
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Failed to decrypt message for summary: Decryption failed
Chat decryption error: Error: Decryption failed
    at decryptWithChatKey (/home/runner/workspace/server/lib/chatCrypto.js:65:13)
    at decryptMessageWithChatKeys (/home/runner/workspace/server/lib/chatCrypto.js:129:27)
    at file:///home/runner/workspace/server/routes/chatSummary.js:153:29
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Failed to decrypt message for summary: Decryption failed
üìù Formatted messages for AI: 8 [
  { sender: 'hatake', content: '[Unable to decrypt]' },
  { sender: 'hatake', content: '[Unable to decrypt]' },
  { sender: 'hatake', content: '[Unable to decrypt]' }
]
Gemini summarization error: GoogleGenerativeAIFetchError: [GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent: [403 Forbidden] Your API key was reported as leaked. Please use another API key.
    at handleResponseNotOk (file:///home/runner/workspace/node_modules/@google/generative-ai/dist/index.mjs:432:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async makeRequest (file:///home/runner/workspace/node_modules/@google/generative-ai/dist/index.mjs:401:9)
    at async generateContent (file:///home/runner/workspace/node_modules/@google/generative-ai/dist/index.mjs:865:22)
    at async summarizeChat (file:///home/runner/workspace/server/services/aiService.js:80:20)
    at async file:///home/runner/workspace/server/routes/chatSummary.js:182:20 {
  status: 403,
  statusText: 'Forbidden',
  errorDetails: undefined
}
Generate summary error: Error: Failed to generate summary
    at summarizeChat (file:///home/runner/workspace/server/services/aiService.js:92:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///home/runner/workspace/server/routes/chatSummary.js:182:20
=== MIDDLEWARE: AUTHENTICATING USER ===
User from token: user
User ID from token: 68fccb98121ce62dd84bbd9e
User ID from DB: 68fccb98121ce62dd84bbd9e
Username from DB: user
This user has 9 authorized IPs
Middleware IP check: 103.240.170.229 === 43.250.158.91 ? false
Middleware IP check: 106.205.238.145 === 43.250.158.91 ? false
Middleware IP check: 127.0.0.1 === 43.250.158.91 ? false
Middleware IP check: 103.70.34.146 === 43.250.158.91 ? false
Middleware IP check: 103.70.34.146 === 43.250.158.91 ? false
Middleware IP check: 103.249.234.48 === 43.250.158.91 ? false
Middleware IP check: 103.240.170.155 === 43.250.158.91 ? false
Middleware IP check: 43.250.158.91 === 43.250.158.91 ? true
‚úì Middleware: IP 43.250.158.91 is authorized for user user
üì¨ Fetching friend requests for user: user
üì• Received requests: 0
üì§ Sent requests: 0
‚úÖ Sending response with: { receivedCount: 0, sentCount: 0 }
^C